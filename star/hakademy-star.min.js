!function(win){if(!win||win!==window)throw"window가 정의되지 않았습니다";function PointManager(target,options){this.__target=target,this.__options=options}win.Hakademy=win.Hakademy||{},win.Hakademy.PointManager=win.Hakademy.PointManager||PointManager,win.document.styleSheets[0].addRule(".star-wrap","display:inline-block; position:relative; overflow:hidden;"),win.document.styleSheets[0].addRule(".star-wrap::after","content:''; display:block; clear:both;"),win.document.styleSheets[0].addRule(".star-unit","float:left; background-repeat:no-repeat; background-position:right 0;"),win.document.styleSheets[0].addRule(".star-unit.on","background-position:left 0;"),PointManager.defaultOption={limit:5,areaSize:100,unitSize:15,sendName:"star",readOnly:!1,point:0,imageUrl:"./star.png"},PointManager.seq=Array.from(Array(256).keys()),PointManager.managerList={},PointManager.factory=function(selector,options){var userOptions=options||{},createOptions=Object.assign({},PointManager.defaultOption,userOptions),tags=document.querySelectorAll(selector);if(!tags||!tags.length)throw"적용 대상이 없습니다";tags.forEach((function(element){var manager=new PointManager(element,createOptions).initialize().create();PointManager.managerList[manager.getId()]=manager}))},PointManager.initializeOnLoad=function(){win.addEventListener("load",(function(){var star=PointManager.factory(".star-wrap")}))},PointManager.prototype.initialize=function(){var tag=this.__target;return this.setLimit(tag.getAttribute("data-limit")).setPoint(tag.getAttribute("data-point")).setSendname(tag.getAttribute("data-sendname")).setReadOnly(null!=tag.getAttribute("data-readonly")).setAreaSize(tag.getAttribute("data-areasize")).setUnitSize(tag.getAttribute("data-unitsize")).setId(tag.getAttribute("data-id")).setImageUrl(tag.getAttribute("data-image"))},PointManager.prototype.create=function(){for(var i=0;i<this.getLimit();i++){var unit=this.createUnit();this.isReadOnly()||unit.addEventListener("click",this.clickHandler),i<this.getPoint()&&this.lightOff(unit),this.getTarget().appendChild(unit)}if(this.__sendName){var sendTag=document.createElement("input");sendTag.setAttribute("type","hidden"),sendTag.setAttribute("name",this.getSendName()),sendTag.setAttribute("value",this.getPoint()),this.getTarget().appendChild(sendTag)}return this.changePoint(this.getPoint()),this},PointManager.prototype.createUnit=function(){var div=document.createElement("div");return div.classList.add("star-unit"),div.style.width=this.getUnitSize()+"px",div.style.height=this.getUnitSize()+"px",div.style.backgroundImage="url('"+this.getImageUrl()+"')",div.style.backgroundSize=this.getImageWidth()+"px "+this.getImageHeight()+"px",div},PointManager.prototype.getOptions=function(){return this.__options},PointManager.prototype.getOption=function(key){return this.__options[key]||null},PointManager.prototype.setLimit=function(limit){return this.__limit=parseInt(limit)||this.getOption("limit"),this},PointManager.prototype.setAreaSize=function(areaSize){return this.__areaSize=areaSize,this},PointManager.prototype.setUnitSize=function(unitSize){return this.__unitSize=parseInt(unitSize)||this.getOption("unitSize"),this},PointManager.prototype.setPoint=function(point){return this.__point=parseInt(point)||this.getOption("point"),this},PointManager.prototype.setSendname=function(sendName){return this.__sendName=sendName||this.getOption("sendName"),this},PointManager.prototype.setReadOnly=function(readOnly){return this.__readOnly=readOnly||this.getOption("readOnly"),this},PointManager.prototype.setId=function(id){return id||(id=PointManager.seq.shift(),this.getTarget().setAttribute("data-id",id)),this.__id=id,this},PointManager.prototype.setImageUrl=function(imageUrl){return this.__imageUrl=imageUrl||this.getOption("imageUrl"),this},PointManager.prototype.getTarget=function(){return this.__target},PointManager.prototype.getUnitList=function(){return this.getTarget().childNodes},PointManager.prototype.getUnit=function(index){if(index<0||index>this.getUnitList().length)throw"범위 초과";return this.getUnitList()[index]},PointManager.prototype.getUnitCount=function(){for(var count=0,i=0;i<this.getUnitList().length;i++)this.getUnit(i).classList.contains("star-unit")&&count++;return count},PointManager.prototype.getImageUrl=function(){return this.__imageUrl},PointManager.prototype.getLimit=function(){return this.__limit},PointManager.prototype.getAreaSize=function(){return this.__areaSize},PointManager.prototype.getUnitSize=function(){return this.getAreaSize()?this.getAreaSize()/this.getLimit():this.__unitSize},PointManager.prototype.getPoint=function(){return this.__point},PointManager.prototype.getSendName=function(){return this.__sendName},PointManager.prototype.isReadOnly=function(){return this.__readOnly},PointManager.prototype.getId=function(){return this.__id},PointManager.prototype.getImageWidth=function(){return 2*this.getUnitSize()},PointManager.prototype.getImageHeight=function(){return this.getUnitSize()},PointManager.prototype.clickHandler=function(){for(var tag,div,id=this.parentElement.getAttribute("data-id"),count=0,wrap=PointManager.managerList[id],i=0;i<wrap.getUnitCount()&&(count++,this!==wrap.getUnit(i));i++);wrap.changePoint(count)},PointManager.prototype.changePoint=function(point){point>this.getUnitCount()&&(point=this.getUnitCount());for(var i=0;i<this.getUnitCount();i++)i<point?this.lightOn(this.getUnit(i)):this.lightOff(this.getUnit(i));this.getTarget().setAttribute("data-point",point),this.isReadOnly()||(this.getHiddenInput().value=point)},PointManager.prototype.getHiddenInput=function(){return this.getUnitList()[this.getUnitCount()]},PointManager.prototype.lightOn=function(tag){tag.classList.add("on")},PointManager.prototype.lightOff=function(tag){tag.classList.remove("on")}}(window);