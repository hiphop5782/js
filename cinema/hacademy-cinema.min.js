(function(e){function t(e){var t=window.getComputedStyle(e,null),a=0;return"border-box"===t.boxSizing?parseFloat(t.width)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderLeftWidth)-parseFloat(t.borderRightWidth)-a:parseFloat(t.width)-a}e.Hacademy=e.Hacademy||{},e.Hacademy.util=e.Hacademy.util||{},e.Hacademy.Reservation=function(a,i){if(!a)throw"영역이 정의되지 않았습니다";"string"==typeof a&&(a=document.querySelector(a)),a.addEventListener("contextmenu",function(e){e.preventDefault()});var s=a.querySelector(".cinema-seat-area");if(!s)throw"좌석 영역이 지정되지 않았습니다(class='cinema-seat-area')";var n=s.dataset.rowsize;if(!n)throw"줄의 크기를 올바르게 설정하십시오";var o=s.dataset.colsize;if(!o)throw"칸의 크기를 올바르게 설정하십시오";var r=t(s),c=parseInt(r/o),d=s.dataset.mode||"client",l=s.dataset.fill||"auto",p=a.dataset.name||"seat",h=s.dataset.seatno||"hidden";this.options={area:a,seatArea:s,rowsize:n,colsize:o,seatAreaWidth:r,unitSize:c,mode:d,fill:l,sendName:p,seatNoVisible:h},"auto"===l?this.automaticFillProcess():this.manualFillProcess(),"manager"===d&&this.addManagerEventListener();var m=this;e.addEventListener("resize",function(){m.resize()}),m.resize(),i&&i()},e.Hacademy.Reservation.prototype.addManagerEventListener=function(){var e=this,t=this.options.area;t.setAttribute("tabindex","0"),t.addEventListener("mouseenter",function(e){e.target.focus()}),t.addEventListener("keydown",function(t){switch(t.preventDefault(),t.key.toLowerCase()){case"f2":e.mergeSpace();break;case"f3":e.setDisable();break;case"delete":e.deleteSpace()}});for(var a=this.options.seatArea,i=a.querySelectorAll(".cinema-seat"),s=0;s<i.length;s++)i[s].addEventListener("contextmenu",function(t){t.preventDefault(),e.changeUnit(this,"direction")})},e.Hacademy.Reservation.prototype.addChangeListener=function(e){"function"==typeof e&&(this.changeListener=e)},e.Hacademy.Reservation.prototype.getQueryString=function(){var e;if("manager"===this.options.mode?e=this.options.seatArea.querySelectorAll(".cinema-seat:not(.empty),.cinema-space"):"client"===this.options.mode&&(e=this.options.seatArea.querySelectorAll(".cinema-seat.active")),e&&0!=e.length){for(var t=new URLSearchParams,a=0;a<e.length;a++){var i=e[a].querySelector("input[type=hidden]");t.append(i.name,i.value)}return t.toString()}},e.Hacademy.Reservation.prototype.setDisable=function(){for(var e=this.options.seatArea.querySelectorAll(".cinema-seat.active"),t=0;t<e.length;t++)this.changeUnit(e[t],"disabled")},e.Hacademy.Reservation.prototype.automaticFillProcess=function(){for(var e=1;e<=this.options.rowsize;e++)for(var t=1;t<=this.options.colsize;t++){var a=this.createUnit("normal");a.dataset.direction="up",a.dataset.row=e,a.dataset.col=t,a.setSeatNumber&&a.setSeatNumber(e+"-"+t),this.options.seatArea.appendChild(a)}this.refreshValue()},e.Hacademy.Reservation.prototype.manualFillProcess=function(){var e=this.options.rowsize,t=this.options.colsize,a=this.options.seatArea,i=a.cloneNode(!0);this.options.seatArea.innerHTML="";for(var s=1;s<=e;s++)for(var n=1;n<=t;n++){var o=i.querySelector(".cinema-seat[data-row='"+s+"'][data-col='"+n+"']");if(o){var r=o.dataset.state||"normal",c=this.createUnit(r);c.dataset.row=s,c.dataset.col=n,c.dataset.direction=o.dataset.direction||"up",a.appendChild(c),c.setSeatNumber&&c.setSeatNumber(s+"-"+n)}else{c=this.createUnit("empty");a.appendChild(c)}}this.refreshSpace()},e.Hacademy.Reservation.prototype.createUnit=function(e){var t=this;if("empty"===e){var a=this.createUnit();return a.classList.add("empty"),a}if("active"===e){a=this.createUnit();return a.classList.add("active"),a.addEventListener("click",function(e){var a=this.classList.contains("active");t.changeUnit(this,a?"normal":"active")}),a}if("normal"===e){a=this.createUnit();return a.addEventListener("click",function(e){var a=this.classList.contains("active");t.changeUnit(this,a?"normal":"active")}),a}if("disabled"===e){a=this.createUnit();return a.classList.add("disabled"),a}if("space"===e){a=document.createElement("div");return a.classList.add("cinema-space"),a.style.width=this.options.unitSize+"px",a.style.height=this.options.unitSize+"px",a}a=document.createElement("div");if(a.appendChild(this.createHiddenInput()),a.classList.add("cinema-seat"),a.style.width=this.options.unitSize+"px",a.style.height=this.options.unitSize+"px","visible"===this.options.seatNoVisible){var i=document.createElement("span");a.setSeatNumber=function(e){i.textContent=e},i.addEventListener("contextmenu",function(e){e.preventDefault(),e.stopPropagation(),a.dispatchEvent(new Event("contextmenu"))}),a.appendChild(i)}return a},e.Hacademy.Reservation.prototype.createHiddenInput=function(){var e=document.createElement("input");return e.setAttribute("type","hidden"),e.setAttribute("name",this.options.sendName),e},e.Hacademy.Reservation.prototype.deleteSpace=function(){for(var e=this.options.seatArea.querySelectorAll(".cinema-seat.active"),t=0;t<e.length;t++)this.changeUnit(e[t],"empty")},e.Hacademy.Reservation.prototype.mergeSpace=function(){for(var e=this.options.seatArea.querySelectorAll(".cinema-seat.active"),t=0;t<e.length;t++)this.changeUnit(e[t],"space");this.refreshSpace()},e.Hacademy.Reservation.prototype.refreshSpace=function(){for(var e=this.options.seatArea.querySelectorAll(".cinema-space"),t=0;t<e.length;t++)this.calculateMergeSpace(e[t])},e.Hacademy.Reservation.prototype.calculateMergeSpace=function(e){var t=parseInt(e.dataset.row),a=parseInt(e.dataset.col);if(t>0){var i=this.options.seatArea.querySelector(".cinema-space[data-row='"+(t-1)+"'][data-col='"+a+"']");i&&(e.classList.add("top"),i.classList.contains("bottom")||i.classList.add("bottom"))}if(t<this.options.rowsize){i=this.options.seatArea.querySelector(".cinema-space[data-row='"+(t+1)+"'][data-col='"+a+"']");i&&(e.classList.add("bottom"),i.classList.contains("top")||i.classList.add("top"))}if(a>0){i=this.options.seatArea.querySelector(".cinema-space[data-row='"+t+"'][data-col='"+(a-1)+"']");i&&(e.classList.add("left"),i.classList.contains("right")||i.classList.add("right"))}if(a<this.options.colsize){i=this.options.seatArea.querySelector(".cinema-space[data-row='"+t+"'][data-col='"+(a+1)+"']");i&&(e.classList.add("right"),i.classList.contains("left")||i.classList.add("left"))}},e.Hacademy.Reservation.prototype.changeUnit=function(e,t){var a=this;if("space"===t){e.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),e.removeChild(e.querySelector("span")),e.classList.add("cinema-space"),e.removeAttribute("data-direction"),e.dataset.state=t;var i=e.cloneNode(!0);e.parentNode.replaceChild(i,e)}else if("empty"===t){e.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),e.textContent="",e.classList.add("cinema-seat","empty"),e.removeAttribute("data-direction"),e.dataset.state=t;i=e.cloneNode(!0);e.parentNode.replaceChild(i,e)}else if("disabled"===t){e.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),e.classList.add("cinema-seat","disabled"),e.dataset.state=t;i=e.cloneNode(!0);i.addEventListener("contextmenu",function(e){e.preventDefault(),a.changeUnit("direction")}),e.parentNode.replaceChild(i,e)}else if("active"===t)e.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),e.classList.add("cinema-seat","active"),e.dataset.state=t;else if("normal"===t)e.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),e.classList.add("cinema-seat"),e.dataset.state=t;else if("direction"===t)switch(e.dataset.direction){case"up":e.dataset.direction="right";break;case"right":e.dataset.direction="down";break;case"down":e.dataset.direction="left";break;case"left":e.dataset.direction="up"}a.refreshValue(),a.changeListener&&a.changeListener.call(a,e)},e.Hacademy.Reservation.prototype.refreshValue=function(){var e;if("manager"===this.options.mode?e=this.options.seatArea.querySelectorAll(".cinema-seat, .cinema-space"):"client"===this.options.mode&&(e=this.options.seatArea.querySelectorAll(".cinema-seat")),e)for(var t=0;t<e.length;t++)this.setValue(e[t])},e.Hacademy.Reservation.prototype.setValue=function(e){if(!e.classList.contains("empty")){var t="-",a="";a+=e.dataset.row,a+=t,a+=e.dataset.col,"manager"===this.options.mode&&(a+=t,a+=e.dataset.state||"normal",a+=t,a+=e.dataset.direction||"up"),e.querySelector("input").value=a}},e.Hacademy.Reservation.prototype.resize=function(){this.options.seatAreaWidth=t(this.options.seatArea),this.options.unitSize=parseInt(this.options.seatAreaWidth/this.options.colsize);for(var e=this.options.seatArea.querySelectorAll(".cinema-seat"),a=0;a<e.length;a++)e[a].style.width=this.options.unitSize+"px",e[a].style.height=this.options.unitSize+"px";var i=this.options.seatArea.querySelectorAll(".cinema-space");for(a=0;a<i.length;a++)i[a].style.width=this.options.unitSize+"px",i[a].style.height=this.options.unitSize+"px"}})(window);