!function(w){function calculateInnerWidth(tag){var style=window.getComputedStyle(tag,null),fix=0;return"border-box"===style.boxSizing?parseFloat(style.width)-parseFloat(style.paddingLeft)-parseFloat(style.paddingRight)-parseFloat(style.borderLeftWidth)-parseFloat(style.borderRightWidth)-0:parseFloat(style.width)-0}w.Hacademy=w.Hacademy||{},w.Hacademy.util=w.Hacademy.util||{},w.Hacademy.Reservation=function(area,callback){if(!area)throw"영역이 정의되지 않았습니다";"string"==typeof area&&(area=document.querySelector(area)),area.addEventListener("contextmenu",(function(e){e.preventDefault()}));var seatArea=area.querySelector(".cinema-seat-area");if(!seatArea)throw"좌석 영역이 지정되지 않았습니다(class='cinema-seat-area')";var rowsize=seatArea.dataset.rowsize;if(!rowsize)throw"줄의 크기를 올바르게 설정하십시오";var colsize=seatArea.dataset.colsize;if(!colsize)throw"칸의 크기를 올바르게 설정하십시오";var seatAreaWidth=calculateInnerWidth(seatArea),unitSize=parseInt(seatAreaWidth/colsize),mode=seatArea.dataset.mode||"client",fill=seatArea.dataset.fill||"auto",choice=seatArea.dataset.choice||"multiple",sendName=area.dataset.name||"seat",direction=area.dataset.direction||"up",seatNoVisible=seatArea.dataset.seatno||"hidden",rowname=seatArea.dataset.rowname||"number",colname=seatArea.dataset.colname||"number";this.options={area:area,seatArea:seatArea,rowsize:rowsize,colsize:colsize,seatAreaWidth:seatAreaWidth,unitSize:unitSize,mode:mode,choice:choice,fill:fill,sendName:sendName,seatNoVisible:seatNoVisible,rowname:rowname,colname:colname},"auto"===fill?this.automaticFillProcess():this.manualFillProcess(),"manager"===mode&&this.addManagerEventListener();var app=this;w.addEventListener("resize",(function(){app.resize()})),app.resize(),callback&&callback()},w.Hacademy.Reservation.prototype.addManagerEventListener=function(){var app=this,area=this.options.area;area.setAttribute("tabindex","0"),area.addEventListener("mouseenter",(function(e){e.target.focus()})),area.addEventListener("keydown",(function(e){switch(e.preventDefault(),e.key.toLowerCase()){case"f2":app.mergeSpace();break;case"f3":app.setDisable();break;case"delete":app.deleteSpace()}}));for(var seatArea=this.options.seatArea,seatList=seatArea.querySelectorAll(".cinema-seat"),rotateMode=void 0!==seatArea.dataset.rotate,i=0;rotateMode&&i<seatList.length;i++)seatList[i].addEventListener("contextmenu",(function(e){e.preventDefault(),app.changeUnit(this,"direction")}))},w.Hacademy.Reservation.prototype.addBeforeChangeListener=function(listener){"function"==typeof listener&&(this.beforeChangeListener=listener)},w.Hacademy.Reservation.prototype.addChangeListener=function(listener){"function"==typeof listener&&(this.changeListener=listener)},w.Hacademy.Reservation.prototype.getSelectedSeatList=function(){return"manager"===this.options.mode?this.options.seatArea.querySelectorAll(".cinema-seat:not(.empty),.cinema-space"):"client"===this.options.mode?this.options.seatArea.querySelectorAll(".cinema-seat.active"):null},w.Hacademy.Reservation.prototype.getSelectedCount=function(){var checkedList=this.getSelectedSeatList();return checkedList?checkedList.length:0},w.Hacademy.Reservation.prototype.getQueryString=function(){var checkedList=this.getSelectedSeatList();if(checkedList&&0!=checkedList.length){for(var params=new URLSearchParams,i=0;i<checkedList.length;i++){var unit=checkedList[i].querySelector("input[name=seat]");params.append(unit.name,unit.value)}return params.toString()}},w.Hacademy.Reservation.prototype.setDisable=function(){for(var activeSeatList=this.options.seatArea.querySelectorAll(".cinema-seat.active"),i=0;i<activeSeatList.length;i++)this.changeUnit(activeSeatList[i],"disabled")},w.Hacademy.Reservation.prototype.getRowBegin=function(){return"number"===this.options.rowname?1:"A".charCodeAt(0)},w.Hacademy.Reservation.prototype.getRowEnd=function(){var row=parseInt(this.getRowBegin());return row+=parseInt(this.options.rowsize)-1},w.Hacademy.Reservation.prototype.getColumnBegin=function(){return"number"===this.options.colname?1:"A".charCodeAt(0)},w.Hacademy.Reservation.prototype.getColumnEnd=function(){var column=parseInt(this.getColumnBegin());return column+=parseInt(this.options.colsize)-1},w.Hacademy.Reservation.prototype.convertRowToNumber=function(v){return"alphabet"===this.options.rowname?v.charCodeAt(v):parseInt(v)},w.Hacademy.Reservation.prototype.convertRowToOrigin=function(v){return"alphabet"===this.options.rowname?String.fromCharCode(v):v},w.Hacademy.Reservation.prototype.convertColumnToNumber=function(v){return"alphabet"===this.options.colname?v.charCodeAt(v):parseInt(v)},w.Hacademy.Reservation.prototype.convertColumnToOrigin=function(v){return"alphabet"===this.options.colname?String.fromCharCode(v):v},w.Hacademy.Reservation.prototype.automaticFillProcess=function(){for(var rowBegin=this.getRowBegin(),rowEnd=this.getRowEnd(),colBegin=this.getColumnBegin(),colEnd=this.getColumnEnd(),i=rowBegin;i<=rowEnd;i++)for(var j=colBegin;j<=colEnd;j++){var rowValue=this.convertRowToOrigin(i),colValue=this.convertColumnToOrigin(j),seat=this.createUnit("normal");seat.dataset.direction="up",seat.dataset.row=rowValue,seat.dataset.col=colValue,seat.setSeatNumber&&seat.setSeatNumber(rowValue+"-"+colValue),this.options.seatArea.appendChild(seat)}this.refreshValue()},w.Hacademy.Reservation.prototype.manualFillProcess=function(){var rowBegin=this.getRowBegin(),rowEnd=this.getRowEnd(),colBegin=this.getColumnBegin(),colEnd=this.getColumnEnd(),seatArea=this.options.seatArea,cloneSeatArea=seatArea.cloneNode(!0);this.options.seatArea.innerHTML="";for(var i=rowBegin;i<=rowEnd;i++)for(var j=colBegin;j<=colEnd;j++){var rowValue="alphabet"===this.options.rowname?String.fromCharCode(i):i,colValue="alphabet"===this.options.colname?String.fromCharCode(j):j,findElement=cloneSeatArea.querySelector(".cinema-seat[data-row='"+rowValue+"'][data-col='"+colValue+"']");if(findElement){var state=findElement.dataset.state||"normal",seat;(seat=this.createUnit(state)).dataset.row=rowValue,seat.dataset.col=colValue,seat.dataset.direction=findElement.dataset.direction||"up",seatArea.appendChild(seat),seat.setSeatNumber&&seat.setSeatNumber(rowValue+"-"+colValue)}else{var seat=this.createUnit("empty");seatArea.appendChild(seat)}}this.refreshSpace()},w.Hacademy.Reservation.prototype.createUnit=function(v){var app=this,seat,seat,seat,seat,seat,seat;if("empty"===v)return(seat=this.createUnit()).classList.add("empty"),seat;if("active"===v)return(seat=this.createUnit()).classList.add("active"),seat.addEventListener("click",(function(e){var isActive=this.classList.contains("active");app.changeUnit(this,isActive?"normal":"active"),"client"===app.options.mode&&(this.querySelector("input[name=seat]").checked=!isActive)})),seat;if("normal"===v)return(seat=this.createUnit()).addEventListener("click",(function(e){var isActive=this.classList.contains("active");app.changeUnit(this,isActive?"normal":"active"),"client"===app.options.mode&&(this.querySelector("input[name=seat]").checked=!isActive)})),seat;if("disabled"===v)return(seat=this.createUnit()).classList.add("disabled"),seat;if("space"===v)return(seat=document.createElement("div")).classList.add("cinema-space"),seat.style.width=this.options.unitSize+"px",seat.style.height=this.options.unitSize+"px",seat;if((seat=document.createElement("div")).appendChild(this.createHiddenInput()),seat.classList.add("cinema-seat"),seat.style.width=this.options.unitSize+"px",seat.style.height=this.options.unitSize+"px","visible"===this.options.seatNoVisible){var span=document.createElement("span");seat.setSeatNumber=function(v){span.textContent=v},span.addEventListener("contextmenu",(function(e){e.preventDefault(),e.stopPropagation(),seat.dispatchEvent(new Event("contextmenu"))})),seat.appendChild(span)}return seat},w.Hacademy.Reservation.prototype.createHiddenInput=function(){var hidden=document.createElement("input");return"manager"===this.options.mode?hidden.setAttribute("type","hidden"):hidden.setAttribute("type","checkbox"),hidden.setAttribute("name",this.options.sendName),hidden.style.display="none",hidden},w.Hacademy.Reservation.prototype.deleteSpace=function(){for(var checkspace=this.options.seatArea.querySelectorAll(".cinema-seat.active"),i=0;i<checkspace.length;i++)this.changeUnit(checkspace[i],"empty")},w.Hacademy.Reservation.prototype.mergeSpace=function(){for(var checkspace=this.options.seatArea.querySelectorAll(".cinema-seat.active"),i=0;i<checkspace.length;i++)this.changeUnit(checkspace[i],"space");this.refreshSpace()},w.Hacademy.Reservation.prototype.refreshSpace=function(){for(var checkspace=this.options.seatArea.querySelectorAll(".cinema-space"),i=0;i<checkspace.length;i++)this.calculateMergeSpace(checkspace[i])},w.Hacademy.Reservation.prototype.calculateMergeSpace=function(unit){var row=unit.dataset.row,col=unit.dataset.col,rowNumber=this.convertRowToNumber(row),colNumber=this.convertColumnToNumber(col);if(rowNumber>0){var rowValue=this.convertRowToOrigin(rowNumber-1),colValue=this.convertColumnToOrigin(colNumber),tag;(tag=this.options.seatArea.querySelector(".cinema-space[data-row='"+rowValue+"'][data-col='"+colValue+"']"))&&(unit.classList.add("top"),tag.classList.contains("bottom")||tag.classList.add("bottom"))}if(row<this.options.rowsize){var rowValue=this.convertRowToOrigin(rowNumber+1),colValue=this.convertColumnToOrigin(colNumber),tag;(tag=this.options.seatArea.querySelector(".cinema-space[data-row='"+rowValue+"'][data-col='"+colValue+"']"))&&(unit.classList.add("bottom"),tag.classList.contains("top")||tag.classList.add("top"))}if(col>0){var rowValue=this.convertRowToOrigin(rowNumber),colValue=this.convertColumnToOrigin(colNumber-1),tag;(tag=this.options.seatArea.querySelector(".cinema-space[data-row='"+rowValue+"'][data-col='"+colValue+"']"))&&(unit.classList.add("left"),tag.classList.contains("right")||tag.classList.add("right"))}if(col<this.options.colsize){var rowValue=this.convertRowToOrigin(rowNumber),colValue=this.convertColumnToOrigin(colNumber+1),tag;(tag=this.options.seatArea.querySelector(".cinema-space[data-row='"+rowValue+"'][data-col='"+colValue+"']"))&&(unit.classList.add("right"),tag.classList.contains("left")||tag.classList.add("left"))}},w.Hacademy.Reservation.prototype.changeUnit=function(unit,mode){var app=this,result;if(app.beforeChangeListener&&!1===app.beforeChangeListener.call(app,unit))return;if("space"===mode){unit.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),unit.removeChild(unit.querySelector("span")),unit.classList.add("cinema-space"),unit.removeAttribute("data-direction"),unit.dataset.state=mode;var newUnit=unit.cloneNode(!0);unit.parentNode.replaceChild(newUnit,unit)}else if("empty"===mode){unit.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),unit.textContent="",unit.classList.add("cinema-seat","empty"),unit.removeAttribute("data-direction"),unit.dataset.state=mode;var newUnit=unit.cloneNode(!0);unit.parentNode.replaceChild(newUnit,unit)}else if("disabled"===mode){var newUnit;unit.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),unit.classList.add("cinema-seat","disabled"),unit.dataset.state=mode,(newUnit=unit.cloneNode(!0)).addEventListener("contextmenu",(function(e){e.preventDefault(),app.changeUnit(this,"direction")})),unit.parentNode.replaceChild(newUnit,unit)}else if("active"===mode){if("single"===app.options.choice)for(var list=app.options.seatArea.querySelectorAll(".cinema-seat.active"),i=0;i<list.length;i++)app.changeUnit(list[i],"normal");unit.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),unit.classList.add("cinema-seat","active"),unit.dataset.state=mode}else if("normal"===mode)unit.classList.remove("active","empty","disabled","cinema-seat","cinema-space"),unit.classList.add("cinema-seat"),unit.dataset.state=mode;else if("direction"===mode)switch(unit.dataset.direction){case"up":unit.dataset.direction="right";break;case"right":unit.dataset.direction="down";break;case"down":unit.dataset.direction="left";break;case"left":unit.dataset.direction="up"}app.refreshValue(),app.changeListener&&app.changeListener.call(app,unit)},w.Hacademy.Reservation.prototype.refreshValue=function(){var list;if("manager"===this.options.mode?list=this.options.seatArea.querySelectorAll(".cinema-seat, .cinema-space"):"client"===this.options.mode&&(list=this.options.seatArea.querySelectorAll(".cinema-seat")),list)for(var i=0;i<list.length;i++)this.setValue(list[i])},w.Hacademy.Reservation.prototype.setValue=function(unit){if(!unit.classList.contains("empty")){var seperator="-",value="";value+=unit.dataset.row,value+="-",value+=unit.dataset.col,"manager"===this.options.mode&&(value+="-",value+=unit.dataset.state||"normal",value+="-",value+=unit.dataset.direction||"up"),unit.querySelector("input").value=value}},w.Hacademy.Reservation.prototype.resize=function(){this.options.seatAreaWidth=calculateInnerWidth(this.options.seatArea),this.options.unitSize=parseInt(this.options.seatAreaWidth/this.options.colsize);for(var seatList=this.options.seatArea.querySelectorAll(".cinema-seat"),i=0;i<seatList.length;i++)seatList[i].style.width=this.options.unitSize+"px",seatList[i].style.height=this.options.unitSize+"px";for(var spaceList=this.options.seatArea.querySelectorAll(".cinema-space"),i=0;i<spaceList.length;i++)spaceList[i].style.width=this.options.unitSize+"px",spaceList[i].style.height=this.options.unitSize+"px"}}(window);